pool:
  vmImage: ubuntu-latest

variables:
- group: DigitalOceanRegistry

steps:
  - task: CopyFilesOverSSH@0
    inputs:
      sshEndpoint: 'pleyce.app'
      contents: 'docker-compose.yml'
      targetFolder: '/Workspace'
      readyTimeout: '20000'
  - task: SSH@0
    inputs:
      sshEndpoint: 'pleyce.app'
      runOptions: 'inline'
      inline: |
        cd /Workspace
        echo docker-compose stop
        sudo docker-compose stop
        echo docker-login
        sudo docker login $(RegistryURL) -u $(RegistryUser) -p $(RegistryPassword)
        echo docker-pull & up -d
        sudo docker-compose pull && docker-compose up -d --remove-orphans
      failOnStdErr: false
      readyTimeout: '20000'